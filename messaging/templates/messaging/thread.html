{% extends 'core/base.html' %}

{% block title %}Conversation with {{ other_user.username }}{% endblock %}

{% block content %}
<h2>Conversation with {{ other_user.username }}</h2>

<div class="mb-3">
    {% for msg in messages %}
    <div class="border p-2 mb-2 {% if msg.sender == request.user %}bg-light text-end{% else %}bg-white text-start{% endif %}">
        <strong>{{ msg.sender.username }}</strong>: {{ msg.body }}
        <br><small class="text-muted">{{ msg.sent_at|timesince }} ago</small>
    </div>
    {% empty %}
    <p>No messages yet.</p>
    {% endfor %}
</div>

<h4>Reply</h4>
<form method="post" action="{% url 'messaging:compose_to_user' other_user.id %}">
    {% csrf_token %}
    <div class="mb-3">
        <label for="subject">Subject</label>
        <input type="text" name="subject" class="form-control" required>
    </div>
    <div class="mb-3">
        <label for="body">Message</label>
        <textarea name="body" rows="4" class="form-control" required></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Send</button>
</form>
{% endblock %}
